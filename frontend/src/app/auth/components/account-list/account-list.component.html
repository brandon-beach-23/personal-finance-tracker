<div class="card shadow-md h-full">
  <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">Checking Accounts</h5>

    <!-- Action Buttons -->
    <div class="btn-group" role="group">
      <button type="button"
              class="btn btn-sm btn-light me-2 rounded-lg shadow-sm fw-bold"
              (click)="openAddModal()">
        <i class="bi bi-plus-circle-fill me-1"></i> Add Account
      </button>
      <button type="button"
              class="btn btn-sm btn-outline-light rounded-lg shadow-sm"
              (click)="openEditDeleteMode()">
        <i class="bi bi-pencil-fill me-1"></i> Edit/Delete
      </button>
    </div>
  </div>
  <div class="card-body p-0">
    <!--
        The correct syntax for *ngFor is:
        <ng-container *ngIf="expression"> <element *ngFor="..."></element> </ng-container>
        or using the structural if/else block pattern below, which is cleaner.
    -->
    <ul class="list-group list-group-flush">

      <!-- Checks if the Observable has emitted a value yet -->
      <ng-container *ngIf="checkingAccounts$ | async as accounts; else loading">

        <!-- Display Accounts (The correct *ngFor syntax) -->
        <ng-container *ngIf="accounts.length > 0; else empty">
          <li class="list-group-item d-flex justify-content-between align-items-center account-item"
              *ngFor="let account of accounts"
              (click)="selectAccount(account)"
              [ngClass]="{
               'bg-info-subtle': (selectedAccountName$ | async) === account.accountName,
               'border-primary': (selectedAccountName$ | async) === account.accountName
              }">

            <!-- Account Name -->
            <div>
              <i class="bi bi-bank me-2 text-info"></i>
              <strong>{{ account.accountName }}</strong>
              <div class="text-sm text-muted">{{ account.accountType }}</div>
            </div>

            <!-- Balance -->
            <span class="fw-bold"
                  [class.text-success]="account.balance >= 0"
                  [class.text-danger]="account.balance < 0">
                            {{ account.balance | currency:'USD' }}
                        </span>
          </li>
        </ng-container>

        <!-- Empty state -->
        <ng-template #empty>
          <li class="list-group-item text-center text-muted">No checking accounts found. Click 'Add Account' to begin.</li>
        </ng-template>
      </ng-container>

      <!-- Loading state -->
      <ng-template #loading>
        <li class="list-group-item text-center text-muted">Loading accounts...</li>
      </ng-template>
    </ul>
  </div>
</div>

<!-- Account Modal: Conditionally rendered using the signal value -->
<!-- THIS IS THE SECTION FOR YOUR QUERY -->
<app-account-modal
  *ngIf="isAddModalOpen()"
  (closeModal)="closeAddModal()">
</app-account-modal>

<app-edit-delete-account-modal
  *ngIf="isEditDeleteModalOpen()"
  (close)="closeEditDeleteModal()"
  (accountsChanged)="refreshAccounts()">
</app-edit-delete-account-modal>




